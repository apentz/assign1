---
title: "User Based Collaboration Filtering"
author: "Audrey Pentz"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{User Based Collaboration Filtering}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```


## Introduction

User-Based Collaborative Filtering is 1 of 3 techniques used to build a Recommender System in the cf package. A demonstration of how to use the cf package for User-Based Collaborative Filtering follows. The demonstration uses a book ratings dataset of 10,000 users that have rated 150 books on a scale from 0 to 10 and is loaded with the package. The package can be used in this way on any similar dataset. 

The objectives of this vignette are as follows:
- To transform the data into the format required
- To calculate similarities between Users (rows)
- To make a recommendation for 1 or more Users

## Transform the data

Let's have a look at some data.

```{r, echo=TRUE}

library(cf)
library(dplyr)
library(tidyr)

glimpse(book_ratings)
glimpse(book_info)
glimpse(user_info)

```




### Remove implicit (zero) ratings and NAs

We are only going to use the book_ratings data. Ratings are on a scale from 0 to 10 but not all readers have rated all books. Zero ratings are called implicit ratings where the reader has read the book but not rated it. A rating from 1 to 10 is called an explicit rating where the reader has actively chosen a rating for the book they have read. So we need to remove the implicit (zero ratings). NAs must also be removed, although this is not applicable to this dataset. The function that does this is called `remove_zero_blanks` and can be applied as shown.

```{r, echo=TRUE}

step1 <- cf::remove_zeros_blanks(book_ratings)
glimpse(step1)

```

### Transform from long to wide

We now need to reshape the data so that we have a matrix with Users (readers in this case) in the rows and Items (books in this case) in the columns, with ratings in the body of the matrix. This is demonstrated with the `long_to_wide` function.

```{r, echo=TRUE}

step2 <- cf::long_to_wide(step1, fill = 0)
glimpse(step2)

```


## Calculate Similarities

The cf package uses cosine similarity to calculate similarity scores between pairs of Users (readers in this case). This is done using the `cosine_similarities` function. Whilst there are many functions in other packages that can perform this calculation such as lsa::cosine, text2vec::sim2, 1-stylo::dist.cosine or one could write a function using the crossprod function, these are all computationally expensive and slow to run. The cf package therefore builds on the coop::cosine and coop::tcosine functions which are optimised for computational performance.

```{r, echo=TRUE}

step3 <- cf::cosine_similarities(step2, method = "user")
glimpse(step3)

```


## Use the Similarity Scores to make a Recommendation

We now want to know who is similar to a particular reader.

```{r, echo=TRUE}



```


## Use the Similarities to make a Recommendation

```{r, echo=TRUE}



```

